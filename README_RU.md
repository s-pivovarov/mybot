Mini chat-bot
==============


<p align="center">Чат бот разработан на основе `VK Callback API`</p>

> Рабочий пример бота: <a href="https://vk.com/club165341629">MyBot</a>

`Callback API` работает по принципу событий в любом языке программирования - событие 
инициализируется на сервере vk, а в качестве обработчика служит **ваш** сервер.

Чтобы не перезагружать сервер, можно выбрать определенные типы событий в 
настройке вашего сообщества vk.

Все данные передаются в формате _json_.

# Установка бота
Для начала, нужно создать сообщество в vk. Затем в пункте 
`Управление сообществом > Работы с API > Ключи доступа` нужно сгенерировать 
ключ доступа сообщества.

Следующий шаг - это развернуть бота на сервере.

Склонируйте проект из репозитория
и измените параметры в `config.php`
> **CONFIRM_KEY** - находится на вкладке `Управление сообществом > Работы с API > Callback API`
```php
    define('ACCESS_TOKEN', 'a55a5ddbcfdd8c69984fe673487ca862b6f4ad2c7d0bbd0a6540091174bd6e2332bc8e29ce27c24dec2c6');
    define('CONFIRM_KEY', 'de2a6ad9');
    define('API_VERSION', '5.74');
    define('STATUS', 'dev'); // этап разработки dev - разработка, prod - релиз
```
После этого, зайдите в сообщество `Управление сообществом > Работы с API > Callback API`
и заполните адрес сервера и нажмите кнопку `Подтвердить`. Это подтвердит, что вы владелец сервера.

На вкладке `Управление сообществом > Работы с API > Callback API > События` 
нужно выбрать **Входящее сообщение**

> **Не забудьте разрешить отправку сообщений сообществу!!!**

Готово! Бот работает, можете отправлять сообщения сообществу.
# Типы событий

Чтобы обработать другие типы событий Callback API, добавляйте соответствующие
`case` в тело `switch`
```php
    switch ($data['type']) {
        case EVENT_CONFIRMATION:
            exit($vk->getConfirm());
        break;

        case EVENT_MESSAGE_NEW:
            include('actions/message.php');
        break;
    }
```

Структура проекта рассчитана на дальнейшее развитие и поддержание

# Описание файлов каталогов
 - `index.php` ключевой файл на который идут все запросы
 - `config.php` содержит глобальные переменные
 - `actions/` содержит файлы с действиями по типу события
 - `actions/message.php` отвечает за событие нового сообщения
 - `lib/` библиотеки(в основном классы)
 - `lib/vk.php` библиотека vk API
 - `lib/bot.php` библиотека с дополнительными функциями
 - `src/` ключевой каталог в котором находятся команды и фразы
 - `src/phrases/` каталог с фразами
 - `src/phrases/user.php` фразы которые присылает пользователь
 - `src/phrases/bot.php` фразы которыми отвечает бот
 
# Схема работы
 - Входящий запрос переводится в массив
 - через `switch` выбирается тип действия
 - подключается файл действия - `action/*.php` либо выполняется простой модуль
 - отправляется ответ
 
 > Автор: <a href="https://vk.com/p.sergey_01">Пивоваров Сергей</a>